

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Accessory Authentication &mdash; HomeKit ADK  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="_static/collapsible-lists/css/tree_view.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/tabs.js"></script>
        <script src="_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Provisioning Tools" href="provisioning_tools.html" />
    <link rel="prev" title="Accessory Pairing" href="accessory_pairing.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> HomeKit ADK
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="adk_architecture.html">ADK Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="adk_directory_structure.html">ADK Directory Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker with ADK</a></li>
</ul>
<p class="caption"><span class="caption-text">Step-by-step Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started with ADK</a></li>
<li class="toctree-l1"><a class="reference internal" href="raspi_setup.html">Raspberry Pi Setup Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="bct.html">Bonjour Conformance Test (BCT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="wac_on_raspberrypi.html">WAC on Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="camera_on_darwin.html">Camera on macOS</a></li>
</ul>
<p class="caption"><span class="caption-text">Troubleshooting ADK</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="interact_with_applications.html">Interacting with ADK applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting ADK</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing_unit_tests.html">Writing Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug_adk.html">Debugging ADK Applications</a></li>
</ul>
<p class="caption"><span class="caption-text">ADK Development</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="accessory_development.html">Accessory Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="accessory_pairing.html">Accessory Pairing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Accessory Authentication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#hardware-authentication">Hardware Authentication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-connect-an-apple-authentication-coprocessor">How to Connect an Apple Authentication Coprocessor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compile">Compile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#provision">Provision</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#software-authentication">Software Authentication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Compile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Provision</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="provisioning_tools.html">Provisioning Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="ADK_Memory_Usage_and_Requirements.html">Memory Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="crypto.html">Cryptographic Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="make_options.html">Compile Time Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding_convention.html">Coding Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration_guide.html">ADK Migration Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">HomeKit Services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="accessory_diagnostics.html">Accessory Diagnostics Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="accessory_metrics.html">Accessory Metrics Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="adaptive_light.html">Adaptive Lighting Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="appletv_remote.html">Apple TV Remote</a></li>
<li class="toctree-l1"><a class="reference internal" href="firmware_update.html">Firmware Update Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="homekit_bridge.html">HomeKit Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="ip_camera.html">IP Camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="lock_profile.html">Lock Profile</a></li>
<li class="toctree-l1"><a class="reference internal" href="stateless_programmable_switch.html">Stateless Programmable Switch</a></li>
<li class="toctree-l1"><a class="reference internal" href="thread.html">HAP over Thread Profile</a></li>
<li class="toctree-l1"><a class="reference internal" href="wifi_reconfiguration_feature.html">WiFi Reconfiguration Service</a></li>
</ul>
<p class="caption"><span class="caption-text">PAL APIs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="_api_docs/dir_PAL.html">Directory PAL</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">HomeKit ADK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Accessory Authentication</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/accessory_authentication.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="accessory-authentication">
<h1>Accessory Authentication<a class="headerlink" href="#accessory-authentication" title="Permalink to this headline">¶</a></h1>
<p>During the pairing of an accessory with an iOS device, the accessory is authenticated before it is paired. Authentication
either requires an <em>Apple Authentication 3.0 Coprocessor</em> integrated in the accessory <em>(Hardware authentication)</em>, or a
unique token stored in the accessory <em>(Software Authentication)</em>.</p>
<div class="section" id="hardware-authentication">
<h2>Hardware Authentication<a class="headerlink" href="#hardware-authentication" title="Permalink to this headline">¶</a></h2>
<p>This authentication requires an <em>Apple Authentication 3.0 Coprocessor</em> chip to be connected to the accessory.</p>
<div class="section" id="how-to-connect-an-apple-authentication-coprocessor">
<h3>How to Connect an Apple Authentication Coprocessor<a class="headerlink" href="#how-to-connect-an-apple-authentication-coprocessor" title="Permalink to this headline">¶</a></h3>
<p>Please follow the instructions below for your target platform.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-bWFjT1M=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="0">macOS</button><button aria-controls="panel-0-UmFzcGJlcnJ5IFBp" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-UmFzcGJlcnJ5IFBp" name="UmFzcGJlcnJ5IFBp" role="tab" tabindex="-1">Raspberry Pi</button></div><div aria-labelledby="tab-0-bWFjT1M=" class="sphinx-tabs-panel group-tab" id="panel-0-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><p>Hardware Needed:</p>
<ul class="simple">
<li><p>Microchip ADM00559 (MMCP2221)</p></li>
<li><p>MFi v3 chip</p></li>
</ul>
<p>Mapping for MMCP2221 module to MFi v3 chip:</p>
<ul class="simple">
<li><p>VDD/VCC</p></li>
<li><p>SCL/SCL</p></li>
<li><p>SDA/SDA</p></li>
<li><p>GND/GND</p></li>
</ul>
</div><div aria-labelledby="tab-0-UmFzcGJlcnJ5IFBp" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-UmFzcGJlcnJ5IFBp" name="UmFzcGJlcnJ5IFBp" role="tabpanel" tabindex="0"><p><strong>MFi Auth Chip v3</strong></p>
<p>The following table and diagram illustrate the wiring for a Raspberry Pi with a Auth Chip v3:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 37%" />
<col style="width: 35%" />
<col style="width: 13%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Raspberry Pi GPIO Connector</p></th>
<th class="head"><p>Signal</p></th>
<th class="head"><p>Pin</p></th>
<th class="head"><p>Wire Color</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>3.3 V</p></td>
<td><p>5</p></td>
<td><p>orange</p></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p>Ground</p></td>
<td><p>7</p></td>
<td><p>blue</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>SDA</p></td>
<td><p>5</p></td>
<td><p>yellow</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>SDL</p></td>
<td><p>1</p></td>
<td><p>green</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>“Reset, Address (= Ground)”</p></td>
<td><p>8</p></td>
<td><p>black</p></td>
</tr>
</tbody>
</table>
<img alt="_images/hw_auth_v3_raspi.png" src="_images/hw_auth_v3_raspi.png" />
</div></div>
</div>
<div class="section" id="compile">
<h3>Compile<a class="headerlink" href="#compile" title="Permalink to this headline">¶</a></h3>
<p>Run the following command to build ADK applications with Hardware Authentication enabled.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>make <span class="nv">USE_HW_AUTH</span><span class="o">=</span><span class="m">1</span> apps
</pre></div>
</div>
</div>
<div class="section" id="provision">
<h3>Provision<a class="headerlink" href="#provision" title="Permalink to this headline">¶</a></h3>
<p>No separate provisioning is required for Hardware Authentication to work.</p>
</div>
</div>
<div class="section" id="software-authentication">
<h2>Software Authentication<a class="headerlink" href="#software-authentication" title="Permalink to this headline">¶</a></h2>
<p>For Software Authentication, an initial token is provisioned to the accessory either at the factory during the time of
manufacturing, or via a firmware upgrade for accessories that are already shipping. When an iOS device later adds the
accessory to HomeKit, it requests the token from the accessory during the Pair Setup process and sends it to an Apple
server for validation. If validation is successful, the iOS device obtains a new token from the Apple server and sends
it to the accessory and the previous token is overwritten (token update).</p>
<p>All initial tokens are generated by licensee servers and must be registered with the Apple Server - as defined in
HomeKit Software Authentication Server Specification. Licensee servers produce tokens for IP accessories in a Base64
format.</p>
<p>Please read <em>Section 5.17 Software Authentication</em> of HomeKit Accessory Protocol Specification document for more details.</p>
<div class="section" id="id1">
<h3>Compile<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Software Authentication is enabled in ADK by default so nothing specific needs to be done to enable it.</p>
</div>
<div class="section" id="id2">
<h3>Provision<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Run the following command to provision a mac or a Raspberry Pi based accessory with a Software Token. The script takes
the <em>Base64</em> format as input and produces the raw format that can be stored on the accessory.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>Tools/provision_posix.sh
  --category &lt;category&gt; <span class="se">\</span>
  --product-data &lt;product_data&gt; <span class="se">\</span>
  --setup-code &lt;setup_code&gt; <span class="se">\</span>
  --mfi-token &lt;mfi_token_uuid&gt; &lt;mfi_token&gt; <span class="se">\</span>
  &lt;destination&gt;
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mfi-token</span> <span class="pre">preserve</span></code> argument can be used to preserve a token between tests, otherwise it is deleted / overwritten.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please run <code class="docutils literal notranslate"><span class="pre">Tools/provision_posix.sh</span> <span class="pre">-h</span></code> to get more information about this tool.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="provisioning_tools.html" class="btn btn-neutral float-right" title="Provisioning Tools" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="accessory_pairing.html" class="btn btn-neutral float-left" title="Accessory Pairing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright © 2021 Apple Inc. All Rights Reserved..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>