

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Provisioning Tools &mdash; HomeKit ADK  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="_static/collapsible-lists/css/tree_view.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Memory Requirements" href="ADK_Memory_Usage_and_Requirements.html" />
    <link rel="prev" title="Accessory Authentication" href="accessory_authentication.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> HomeKit ADK
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="adk_architecture.html">ADK Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="adk_directory_structure.html">ADK Directory Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker with ADK</a></li>
</ul>
<p class="caption"><span class="caption-text">Step-by-step Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started with ADK</a></li>
<li class="toctree-l1"><a class="reference internal" href="raspi_setup.html">Raspberry Pi Setup Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="bct.html">Bonjour Conformance Test (BCT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="wac_on_raspberrypi.html">WAC on Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="camera_on_darwin.html">Camera on macOS</a></li>
</ul>
<p class="caption"><span class="caption-text">Troubleshooting ADK</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="interact_with_applications.html">Interacting with ADK applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting ADK</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing_unit_tests.html">Writing Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug_adk.html">Debugging ADK Applications</a></li>
</ul>
<p class="caption"><span class="caption-text">ADK Development</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="accessory_development.html">Accessory Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="accessory_pairing.html">Accessory Pairing</a></li>
<li class="toctree-l1"><a class="reference internal" href="accessory_authentication.html">Accessory Authentication</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Provisioning Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#accessorysetupgenerator">AccessorySetupGenerator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#compile">Compile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run">Run</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#note-for-the-accessory-vendors">Note For the Accessory Vendors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#provision-posix-sh">provision_posix.sh</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#provision-a-software-authentication-token">Provision a Software Authentication Token</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#install-sh">install.sh</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ADK_Memory_Usage_and_Requirements.html">Memory Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="crypto.html">Cryptographic Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="make_options.html">Compile Time Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding_convention.html">Coding Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration_guide.html">ADK Migration Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">HomeKit Services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="accessory_diagnostics.html">Accessory Diagnostics Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="accessory_metrics.html">Accessory Metrics Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="adaptive_light.html">Adaptive Lighting Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="appletv_remote.html">Apple TV Remote</a></li>
<li class="toctree-l1"><a class="reference internal" href="firmware_update.html">Firmware Update Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="homekit_bridge.html">HomeKit Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="ip_camera.html">IP Camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="lock_profile.html">Lock Profile</a></li>
<li class="toctree-l1"><a class="reference internal" href="stateless_programmable_switch.html">Stateless Programmable Switch</a></li>
<li class="toctree-l1"><a class="reference internal" href="thread.html">HAP over Thread Profile</a></li>
<li class="toctree-l1"><a class="reference internal" href="wifi_reconfiguration_feature.html">WiFi Reconfiguration Service</a></li>
</ul>
<p class="caption"><span class="caption-text">PAL APIs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="_api_docs/dir_PAL.html">Directory PAL</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">HomeKit ADK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Provisioning Tools</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/provisioning_tools.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="provisioning-tools">
<h1>Provisioning Tools<a class="headerlink" href="#provisioning-tools" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="#accessorysetupgenerator">AccessorySetupGenerator</a></p></li>
<li><p><a class="reference external" href="#provision-posix-sh">provision_posix.sh</a></p></li>
<li><p><a class="reference external" href="#install-sh">install.sh</a></p></li>
</ul>
<div class="section" id="accessorysetupgenerator">
<h2>AccessorySetupGenerator<a class="headerlink" href="#accessorysetupgenerator" title="Permalink to this headline">¶</a></h2>
<p>The <em>ADK/Tools</em> directory contains the <em>AccessorySetupGenerator</em> tool for macOS and Linux. This tool can be used by
provisioning mechanisms (e.g., the script in <code class="docutils literal notranslate"><span class="pre">ADK/Tools/provision_posix.sh</span></code>) to generate information for the provisioning
of a HomeKit accessory, such as a setup code, a corresponding SRP salt and verifier, and a setup ID. The setup code is
used by an iOS device for setting up an encrypted link with the accessory during HomeKit pairing. The setup ID is used
to identify the accessory to which a scanned label belongs. Start the tool to see the options that it supports. The
output of the generator is sent to stdout, whereas stderr is used for error conditions.</p>
<div class="section" id="compile">
<h3>Compile<a class="headerlink" href="#compile" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>make tools
</pre></div>
</div>
</div>
<div class="section" id="run">
<h3>Run<a class="headerlink" href="#run" title="Permalink to this headline">¶</a></h3>
<p>From the Mac, you can create the provisioning data, e.g., for LightBulb:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./Output/Darwin-x86_64-apple-darwin<span class="k">$(</span>uname -r<span class="k">)</span>/Tool/Tools/AccessorySetupGenerator.OpenSSL <span class="se">\</span>
    --ip <span class="se">\</span>
    --category <span class="m">5</span> <span class="se">\</span>
    --product-data &lt;product_data&gt;
</pre></div>
</div>
<p>This produces the following output in stdout:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="m">1</span>
<span class="m">358</span>-16-884
C3298DA07B626F544394863A54D5B6F2
5CF40BEE1DAD2B213CCC7AC671174874EFB0F10E82F5323B818E5489ECC89F17B19C18829098463304B92C1C20C3084C9E0B46998AF8CA7C95A7F40FFA81E80CACA2314A76CD3830D6731B05612E2C448C0503B0F272164676FA73009191BD32E9EE23BCFFE390798B405C8CE7E63A5978AB2E76896C90B04DC8FB9875281566EBA5734E2C5ADFBE50BB0CC86C1D9046271004FCE7C631D0E2733617669BDF0E9226EFFEBEA4BCC5B3CA905FB7099C3DE2552A55069C8EED209F36FC9F9DA1AD3BEE6FA9B1672B43E9A9693963FA6127B15AAD208B6D23FB3C2E1A614EA3342B833EDE7BD24AFF58A3A1F5DE31863DD0FA39C32553FE19366E74BC0B420E0F0CD52A80B92ABD7A7B43B5185DB556E1F611E21D372A3EC47B93B2B7678AB056B60BF4BED28EA6C22D8B1E76C9885AD996CA7B9E122ABE069DD2ACB3B80E0BC9DB0B738F8541084633D483420543F2D89E382B498B6F41DC3964057357AE009C858477A9544C8D4112D238B5B1D89708D5E98F952F6E09DEBB597FBBE4CBEE0023
GY2B
X-HM://0E66IRD84GY2B0YJH2CJFPA4DMRWGSG
</pre></div>
</div>
<p>The Provision script writes the generated values into files in folder <code class="docutils literal notranslate"><span class="pre">.KeyValueStore</span></code>:</p>
<ul class="simple">
<li><p>File .HomeKitStore/40.10 contains SRP salt and verifier</p></li>
<li><p>File .HomeKitStore/40.11 contains setup ID</p></li>
</ul>
</div>
</div>
<div class="section" id="note-for-the-accessory-vendors">
<h2>Note For the Accessory Vendors<a class="headerlink" href="#note-for-the-accessory-vendors" title="Permalink to this headline">¶</a></h2>
<p>For a licensed accessory, a random setup code and related data <strong>must</strong> be generated for every individual accessory
according to the rules described in the HomeKit Accessory Protocol Specification, and as summarized here:</p>
<ul class="simple">
<li><p>Generate a random setup code in format <em>XXX-XX-XXX</em> with <em>X</em> being a digit from <em>0-9</em>. The code must be generated
using a cryptographically secure random number generator.</p>
<ul>
<li><p>Codes that only consist of a repeating digit are not allowed.</p></li>
<li><p><em>123-45-678</em> and <em>876-54-321</em> are not allowed.</p></li>
</ul>
</li>
<li><p>Generate a random SRP salt (16 random bytes) using a cryptographically secure random number generator.</p></li>
<li><p>Derive the corresponding SRP verifier from the setup code and SRP salt.</p></li>
<li><p>Generate a random setup ID in format <em>XXXX</em> with <em>X</em> being a digit from <em>0-9</em> or a character from <em>A-Z</em>. The ID must be
generated using a cryptographically secure random number generator.</p>
<ul>
<li><p>Lowercase characters are not allowed.</p></li>
</ul>
</li>
<li><p>Derive the setup payload from the setup code and setup ID.</p>
<ul>
<li><p>For manual validation of this task, the HomeKit Accessory Simulator may be used by opening it, then pressing Cmd-2.</p></li>
</ul>
</li>
<li><p>Deploy the SRP salt, the SRP verifier and the setup ID to the accessory.</p>
<ul>
<li><p>If the accessory supports programmable NFC - and only then - also deploy the setup code.</p></li>
<li><p>Depending on how these items are deployed to an accessory, <code class="docutils literal notranslate"><span class="pre">HAPPlatformAccessorySetup.c</span></code> must be adapted accordingly.</p></li>
</ul>
</li>
<li><p>Create a QR code sticker that contains the setup payload and setup code. The sticker will be used by users every time
they want to pair the accessory to an iOS device.</p>
<ul>
<li><p>Implement the QR code as specified in the HomeKit Identity Guidelines.</p></li>
</ul>
</li>
</ul>
<p>If the accessory has a display that supports displaying a setup code or QR code, only the setup ID has to be generated
and deployed in the manufacturing process. The other steps involving setup code, SRP salt, SRP verifier, setup payload,
and the QR code label may be ignored.</p>
<p>The provisioning script <code class="docutils literal notranslate"><span class="pre">ADK/Tools/provision_posix.sh</span></code> serves as a reference implementation of the provisioning
mechanism. With this tool, a target accessory’s key-value store is provisioned with data that is compatible with the
provided implementation of PAL module HAPPlatformAccessorySetup. If the PAL implementation is modified, e.g., in order
to use some other storage mechanism for storing the provisioning information, then this tool must be adapted accordingly.</p>
<p>The Provision tool can be used for hardware authentication (Apple Authentication Coprocessor) as well as software
authentication. Its usage is printed if the script is run without any arguments.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Warning: When you provision a setup or QR code, be aware that for security reasons it is not possible to reconstruct
it from data stored on the accessory.</p>
</div>
</div>
<div class="section" id="provision-posix-sh">
<h2>provision_posix.sh<a class="headerlink" href="#provision-posix-sh" title="Permalink to this headline">¶</a></h2>
<p>This is a primary tools to provision a <em>Posix</em> based HomeKit accessory. This tool is used to generate a
HomeKitStore with the required provisioning information to allow pairing. In the sample POSIX PAL, this HomeKitStore
is a directory containing several files that contains information such as SRP salt and verifier that is required for
pairing a HomeKit ADK accessory with an iOS device along with tokens required for Software Authentication if used.
Example usage:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>Tools/provision_posix.sh
 --category &lt;category&gt; <span class="se">\</span>
 --product-data &lt;product_data&gt; <span class="se">\</span>
 --setup-code &lt;setup_code&gt; <span class="se">\</span>
 &lt;destination&gt;
</pre></div>
</div>
<div class="section" id="provision-a-software-authentication-token">
<h3>Provision a Software Authentication Token<a class="headerlink" href="#provision-a-software-authentication-token" title="Permalink to this headline">¶</a></h3>
<p>Please refer to Software Authentication section of <a class="reference internal" href="accessory_authentication.html"><span class="doc">Accessory Authentication</span></a> for more
details.</p>
</div>
</div>
<div class="section" id="install-sh">
<h2>install.sh<a class="headerlink" href="#install-sh" title="Permalink to this headline">¶</a></h2>
<p>The tool <code class="docutils literal notranslate"><span class="pre">install.sh</span></code> is a wrapper around <code class="docutils literal notranslate"><span class="pre">provision_posix.sh</span></code> tool and is only provided for convenience. This tool
<strong>doesn’t</strong> support all the functionality of the <code class="docutils literal notranslate"><span class="pre">provision_posix.sh</span></code> tool. A typical use of this tool is to provision
an ADK application, copy the ADK application binary on a Raspberry Pi and to run the ADK application in one step
instead of separate individual steps. Example usage:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./Tools/install.sh <span class="se">\</span>
    -d raspi <span class="se">\</span>
    -t ip <span class="se">\</span>
    -a Output/Raspi-armv6k-unknown-linux-gnueabihf/Debug/IP/Applications/Lightbulb.OpenSSL <span class="se">\</span>
    -n &lt;host_name&gt; <span class="se">\</span>
    -p &lt;password&gt; <span class="se">\</span>
    -u &lt;user&gt; <span class="se">\</span>
    -k
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-k</span></code> argument is to create a key-value store with a default setup code of <code class="docutils literal notranslate"><span class="pre">111-22-333</span></code>. Setting this option
clears up the previous key-value store store. So, if you don’t want to have to pair the application again with Home
app on your iOS device the next time you run the application please make sure to <em>not include</em> the argument <code class="docutils literal notranslate"><span class="pre">-k</span></code>
when running the script.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please run <code class="docutils literal notranslate"><span class="pre">Tools/install.sh</span> <span class="pre">-h</span></code> for more information.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="ADK_Memory_Usage_and_Requirements.html" class="btn btn-neutral float-right" title="Memory Requirements" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="accessory_authentication.html" class="btn btn-neutral float-left" title="Accessory Authentication" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright © 2021 Apple Inc. All Rights Reserved..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>