

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Bonjour Conformance Test (BCT) &mdash; HomeKit ADK  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="_static/collapsible-lists/css/tree_view.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="WAC on Raspberry Pi" href="wac_on_raspberrypi.html" />
    <link rel="prev" title="Raspberry Pi Setup Guide" href="raspi_setup.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> HomeKit ADK
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="adk_architecture.html">ADK Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="adk_directory_structure.html">ADK Directory Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker with ADK</a></li>
</ul>
<p class="caption"><span class="caption-text">Step-by-step Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started with ADK</a></li>
<li class="toctree-l1"><a class="reference internal" href="raspi_setup.html">Raspberry Pi Setup Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Bonjour Conformance Test (BCT)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configure-raspberry-pi-for-bonjour-conformance-test">Configure Raspberry Pi for Bonjour Conformance Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="#execute-the-bonjour-conformance-test">Execute the Bonjour Conformance Test</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wac_on_raspberrypi.html">WAC on Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="camera_on_darwin.html">Camera on macOS</a></li>
</ul>
<p class="caption"><span class="caption-text">Troubleshooting ADK</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="interact_with_applications.html">Interacting with ADK applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting ADK</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing_unit_tests.html">Writing Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug_adk.html">Debugging ADK Applications</a></li>
</ul>
<p class="caption"><span class="caption-text">ADK Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="accessory_development.html">Accessory Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="accessory_pairing.html">Accessory Pairing</a></li>
<li class="toctree-l1"><a class="reference internal" href="accessory_authentication.html">Accessory Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="provisioning_tools.html">Provisioning Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="ADK_Memory_Usage_and_Requirements.html">Memory Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="crypto.html">Cryptographic Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="make_options.html">Compile Time Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding_convention.html">Coding Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration_guide.html">ADK Migration Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">HomeKit Services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="accessory_diagnostics.html">Accessory Diagnostics Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="accessory_metrics.html">Accessory Metrics Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="adaptive_light.html">Adaptive Lighting Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="appletv_remote.html">Apple TV Remote</a></li>
<li class="toctree-l1"><a class="reference internal" href="firmware_update.html">Firmware Update Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="homekit_bridge.html">HomeKit Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="ip_camera.html">IP Camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="lock_profile.html">Lock Profile</a></li>
<li class="toctree-l1"><a class="reference internal" href="stateless_programmable_switch.html">Stateless Programmable Switch</a></li>
<li class="toctree-l1"><a class="reference internal" href="thread.html">HAP over Thread Profile</a></li>
<li class="toctree-l1"><a class="reference internal" href="wifi_reconfiguration_feature.html">WiFi Reconfiguration Service</a></li>
</ul>
<p class="caption"><span class="caption-text">PAL APIs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="_api_docs/dir_PAL.html">Directory PAL</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">HomeKit ADK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Bonjour Conformance Test (BCT)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/bct.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bonjour-conformance-test-bct">
<h1>Bonjour Conformance Test (BCT)<a class="headerlink" href="#bonjour-conformance-test-bct" title="Permalink to this headline">¶</a></h1>
<div class="section" id="configure-raspberry-pi-for-bonjour-conformance-test">
<h2>Configure Raspberry Pi for Bonjour Conformance Test<a class="headerlink" href="#configure-raspberry-pi-for-bonjour-conformance-test" title="Permalink to this headline">¶</a></h2>
<p>Raspberry Pi can be setup for BCT by going through the following commands:</p>
<ul class="simple">
<li><p>Compile <em>LightBulb</em> app for RaspberryPi</p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>make <span class="nv">TARGET</span><span class="o">=</span>Raspi <span class="nv">APPS</span><span class="o">=</span>Lightbulb
</pre></div>
</div>
<ul class="simple">
<li><p>Provision and install the application by running the following command:</p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./Tools/install.sh <span class="se">\</span>
    -d raspi <span class="se">\</span>
    -t ip <span class="se">\</span>
    -a Output/Raspi-armv6k-unknown-linux-gnueabihf/Debug/IP/Applications/Lightbulb.OpenSSL <span class="se">\</span>
    -c <span class="m">5</span>
    -n &lt;host_name&gt; <span class="se">\</span>
    -p &lt;password&gt; <span class="se">\</span>
    -u &lt;user&gt; <span class="se">\</span>
    -k <span class="se">\</span>
    -i
</pre></div>
</div>
<ul>
<li><p>Configure LightBulb as a service that is automatically restarted on power on:</p>
<ul class="simple">
<li><p>Create a file <em>/etc/systemd/system/lightbulb.service</em> with the following content:</p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>Acme LightBulb server on port <span class="m">8080</span>

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">WorkingDirectory</span><span class="o">=</span>/home/pi/acme-lightbulb/bin
<span class="nv">ExecStart</span><span class="o">=</span>/home/pi/acme-lightbulb/bin/Lightbulb.OpenSSL
<span class="nv">Restart</span><span class="o">=</span>on-failure

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">daemon-reload</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">lightbulb.service</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">lightbulb.service</span></code></p></li>
</ul>
</li>
<li><p>Prevent <em>host-local.service</em> from interfering with <em>lightbulb.service</em> during BCT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">stop</span> <span class="pre">host-local.service</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">disable</span> <span class="pre">host-local.service</span></code></p></li>
</ul>
</li>
<li><p>To allow ARP packets on the network, add line before exit 0 in file <em>/etc/rc.local</em>. For example, for WiFi:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">link</span> <span class="pre">set</span> <span class="pre">wlan0</span> <span class="pre">promisc</span> <span class="pre">on</span></code></p></li>
</ul>
</li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>These steps are applicable to all network interfaces supported on the accessory, ethernet or WiFi.</p>
</div>
<ul class="simple">
<li><p>Update file <em>/etc/dhcpcd.conf</em>:</p>
<ul>
<li><p>Replace line <code class="docutils literal notranslate"><span class="pre">persistent</span></code> with line <code class="docutils literal notranslate"><span class="pre">#persistent</span></code></p></li>
</ul>
</li>
<li><p>Update file <em>/lib/systemd/system/dhcpcd.service</em>:</p>
<ul>
<li><p>Replace line <code class="docutils literal notranslate"><span class="pre">ExecStop=/sbin/dhcpcd</span> <span class="pre">-x</span></code> with line <code class="docutils literal notranslate"><span class="pre">ExecStop=/sbin/dhcpcd</span> <span class="pre">-x</span> <span class="pre">-k</span></code> and add the line
<code class="docutils literal notranslate"><span class="pre">Restart=always</span></code> at end of the <code class="docutils literal notranslate"><span class="pre">[Service]</span></code> block.</p></li>
</ul>
</li>
<li><p>Reboot Raspberry Pi:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">reboot</span></code></p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>During Bonjour Conformance Test, Raspberry Pi’s hostname and IP address are changed several times. Therefore the
Raspberry Pi might not be accessible via its hostname during and after the test, and a reboot is recommended after
the test. During reboot, the Raspberry Pi’s hostname is reset to the previously supplied hostname.</p>
</div>
<p>Running LightBulb as a Linux service that automatically starts upon reboot is necessary for BCT and for a licensed
accessory. However, during development it is inconvenient. To stop and remove autostart of LightBulb as a service,
use the following commands:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl stop lightbulb.service
sudo systemctl disable lightbulb.service
</pre></div>
</div>
<p>When the LightBulb service is disabled, the <em>host-local.service</em> should be restarted in order to re-enable hostname
resolution; otherwise Raspberry Pi will not be accessible via its hostname and <em>ssh pi&#64;raspberrypi.local</em> will fail.
To restart host-local.service, use the following commands:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl <span class="nb">enable</span> host-local.service
sudo systemctl start host-local.service
sudo reboot
</pre></div>
</div>
</div>
<div class="section" id="execute-the-bonjour-conformance-test">
<h2>Execute the Bonjour Conformance Test<a class="headerlink" href="#execute-the-bonjour-conformance-test" title="Permalink to this headline">¶</a></h2>
<p>Prepare environment and execute BCT according to the Bonjour Conformance Test for HomeKit document. For the cable
change test and hot plug test during BCT, issue the following command on the Raspberry Pi. For example, for WiFi
interface <em>wlan0</em> do the following:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo ip link <span class="nb">set</span> wlan0 down <span class="o">&amp;&amp;</span> sleep <span class="m">11</span> <span class="o">&amp;&amp;</span> sudo ip link <span class="nb">set</span> wlan0 up
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="wac_on_raspberrypi.html" class="btn btn-neutral float-right" title="WAC on Raspberry Pi" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="raspi_setup.html" class="btn btn-neutral float-left" title="Raspberry Pi Setup Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright © 2021 Apple Inc. All Rights Reserved..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>