

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>ADK Architecture &mdash; HomeKit ADK  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="_static/collapsible-lists/css/tree_view.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ADK Directory Structure" href="adk_directory_structure.html" />
    <link rel="prev" title="HomeKit ADK" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> HomeKit ADK
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">ADK Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#accessory-logic">Accessory Logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hap-library">HAP Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pal-interface">PAL Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adk-runloop">ADK RunLoop</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="adk_directory_structure.html">ADK Directory Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker with ADK</a></li>
</ul>
<p class="caption"><span class="caption-text">Step-by-step Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started with ADK</a></li>
<li class="toctree-l1"><a class="reference internal" href="raspi_setup.html">Raspberry Pi Setup Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="bct.html">Bonjour Conformance Test (BCT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="wac_on_raspberrypi.html">WAC on Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="camera_on_darwin.html">Camera on macOS</a></li>
</ul>
<p class="caption"><span class="caption-text">Troubleshooting ADK</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="interact_with_applications.html">Interacting with ADK applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting ADK</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing_unit_tests.html">Writing Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug_adk.html">Debugging ADK Applications</a></li>
</ul>
<p class="caption"><span class="caption-text">ADK Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="accessory_development.html">Accessory Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="accessory_pairing.html">Accessory Pairing</a></li>
<li class="toctree-l1"><a class="reference internal" href="accessory_authentication.html">Accessory Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="provisioning_tools.html">Provisioning Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="ADK_Memory_Usage_and_Requirements.html">Memory Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="crypto.html">Cryptographic Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="make_options.html">Compile Time Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding_convention.html">Coding Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration_guide.html">ADK Migration Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">HomeKit Services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="accessory_diagnostics.html">Accessory Diagnostics Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="accessory_metrics.html">Accessory Metrics Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="adaptive_light.html">Adaptive Lighting Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="appletv_remote.html">Apple TV Remote</a></li>
<li class="toctree-l1"><a class="reference internal" href="firmware_update.html">Firmware Update Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="homekit_bridge.html">HomeKit Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="ip_camera.html">IP Camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="lock_profile.html">Lock Profile</a></li>
<li class="toctree-l1"><a class="reference internal" href="stateless_programmable_switch.html">Stateless Programmable Switch</a></li>
<li class="toctree-l1"><a class="reference internal" href="thread.html">HAP over Thread Profile</a></li>
<li class="toctree-l1"><a class="reference internal" href="wifi_reconfiguration_feature.html">WiFi Reconfiguration Service</a></li>
</ul>
<p class="caption"><span class="caption-text">PAL APIs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="_api_docs/dir_PAL.html">Directory PAL</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">HomeKit ADK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>ADK Architecture</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/adk_architecture.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="adk-architecture">
<h1>ADK Architecture<a class="headerlink" href="#adk-architecture" title="Permalink to this headline">¶</a></h1>
<p>This section provides an overview of HomeKit ADK.</p>
<p><img alt="ADK architecture" src="_images/adk_architecture.png" /></p>
<p>The ADK accessory consists of three major elements: the <em>accessory logic</em>, the <em>HAP Library</em>, and the <em>PAL interface</em>.
The HAP Library implements the HomeKit Accessory Protocol. It is a software layer that resides between the accessory’s
application layer software (e.g., control software for a ceiling fan) and the target platform (e.g., a custom-designed
Linux device).</p>
<div class="section" id="accessory-logic">
<h2>Accessory Logic<a class="headerlink" href="#accessory-logic" title="Permalink to this headline">¶</a></h2>
<p>The accessory logic contains the application-layer code of an accessory. It is written by an accessory manufacturer,
using their particular domain expertise, such as heating and cooling of rooms for thermostat accessories, or audio/video
processing for IP camera accessories. The ADK contains samples for light bulb, thermostat, door lock, camera, HomeKit
bridge accessories etc.</p>
</div>
<div class="section" id="hap-library">
<h2>HAP Library<a class="headerlink" href="#hap-library" title="Permalink to this headline">¶</a></h2>
<p>The HAP API, defined by Apple, allows developers to declare the services and characteristics of the accessory. After
initialization of the target platform, the HomeKit accessory server which handles all HAP communication over IP, BLE or
Thread can be started. When a request comes in (e.g., a request from an iPhone to change the set point of a thermostat)
the HAP Library calls the suitable function pointers provided during the declaration of the services. As these calls go
from the HAP Library “upwards” into the accessory logic, they are called upcalls. Upcalls issued by the HAP Library never
overlap in order to avoid hard-to-find multithreading issues, to make it easy to integrate the HAP Library with other
code, and to make the library usable even on “bare metal” systems without operating system and multithreading support.
The HAP API is simple, and flexible enough to support custom characteristics and services in addition to the
Apple-defined HomeKit profiles.</p>
<p>Apple provides an up-to-date implementation of the HAP Library. It implements the HAP pairing, session, and security
protocols. The single-threaded design of the HAP Library makes it easy to integrate into different environments
(e.g., into device software that already exists and uses a proprietary cloud service for data storage).</p>
</div>
<div class="section" id="pal-interface">
<h2>PAL Interface<a class="headerlink" href="#pal-interface" title="Permalink to this headline">¶</a></h2>
<p>The API of the Platform Abstraction Layer is defined by Apple but unlike the HAP API, it is not implemented by Apple.
It is used by the HAP Library, and must be implemented in a PAL by a platform developer. The PAL API is highly modular
and supports mechanisms including timers, persistent storage, random number generator, and more. It is designed to
provide abstractions for every service that the HAP Library needs, in a way that enables easy implementation with
minimal overhead.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>HomeKit ADK comes with sample Platform implementations for <em>Linux</em>, <em>Raspberry Pi</em>, <em>nRF52</em> and <em>macOS</em>.
Chipset vendors are expected to provide a platform implementation for their respective platforms. Sample PAL
implementations cannot be assumed to be directly usable “as is”.</p>
</div>
</div>
<div class="section" id="adk-runloop">
<h2>ADK RunLoop<a class="headerlink" href="#adk-runloop" title="Permalink to this headline">¶</a></h2>
<p>All API functions of HAP and PAL must be called from the ADK run-loop thread only using the API <code class="docutils literal notranslate"><span class="pre">HAPPlatformRunLoopScheduleCallback</span></code>,
unless otherwise explicitly specified in the API documentation.</p>
<p>The following are the well known exceptions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">HAPLog</span></code> macros. The macros can be called from any thread.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HAPAssert()</span></code>, <code class="docutils literal notranslate"><span class="pre">HAPPrecondition()</span></code> and <code class="docutils literal notranslate"><span class="pre">HAPFatalError()</span></code>.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="adk_directory_structure.html" class="btn btn-neutral float-right" title="ADK Directory Structure" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="HomeKit ADK" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright © 2021 Apple Inc. All Rights Reserved..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>