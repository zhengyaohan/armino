DAC TF卡播放PCM数据demo
========================

:link_to_translation:`en:[English]`

1、功能概述
--------------------
	从TF卡中读取指定的PCM音乐文件并通过DAC进行播放。

2、代码路径
--------------------
	demo路径: ``\components\demos\media\audio\aud\aud_cp0.c``

	AUDIO ADC/DAC API接口的详细说明请参考同网页: ``/api-reference/multi_media/bk_aud.html``

3、cli命令简介
--------------------
demo支持的命令如下表:

+-------------------------------------------+--------------------------+
|Command                                    |Description               |
+===========================================+==========================+
|aud_cp0_sdcard_play_test start 文件名.pcm  |cpu0实时播放pcm音频文件   |
+-------------------------------------------+--------------------------+

demo运行依赖的宏配置:

+---------------------------+----------------------------+----------------------------------------------------+-----+
|Name                       |Description                 |   File                                             |value|
+===========================+============================+====================================================+=====+
|CONFIG_AUDIO               |配置audio功能               |``\middleware\soc\bk7256_cp1\bk7256_cp1.defconfig`` |  y  |
+---------------------------+----------------------------+----------------------------------------------------+-----+
|CONFIG_AUDIO_RISCV_IP_V1_0 |配置audio ip                |``\middleware\soc\bk7256_cp1\bk7256_cp1.defconfig`` |  y  |
+---------------------------+----------------------------+----------------------------------------------------+-----+
|CONFIG_AUDIO_TEST          |配置demo使能                |``\middleware\soc\bk7256\bk7256.defconfig``         |  y  |
+---------------------------+----------------------------+----------------------------------------------------+-----+
|CONFIG_SDCARD_HOST         |配置SDCARD Host使能         |``\middleware\soc\bk7256\bk7256.defconfig``         |  y  |
+---------------------------+----------------------------+----------------------------------------------------+-----+

demo运行依赖的库和驱动:
 - DMA DMA驱动
 - AUD audio模块驱动
 - FATFS fatfs sdcard驱动
 - OS 操作系统信号量

4、演示介绍
--------------------

demo执行的步骤如下:

	1.存放待播放的PCM音频文件到TF卡中
	 - 将pcm格式的文件拷贝到TF卡中，并将汉字文件名改成拼音或者数字
	 
	2.挂载TF卡
	 - Uart发送AT指令 ``fatfstest M 1`` 挂载TF卡

	3.开始播放PCM音频测试
	 - Uart发送AT指令 ``aud_cp0_sdcard_play_test start 文件名.pcm`` 开始播放指定的PCM音频文件


执行测试指令，case的工作流程如下图所示：

.. figure:: ../../../_static/aud_pcm_to_dac.png
    :align: center
    :alt: tf_pcm_to_dac demo软件流程
    :figclass: align-center

    Figure 1. tf pcm to dac demo flow chart

5、详细配置及说明
--------------------------

- AUDIO_DAC性能

AUDIO_DAC支持的采样率Fs(bps):

  - 8K
  - 16K
  - 44.1K
  - 48K

此外，还采用手动设置采样率的功能来提供特殊的采样率设置，具体的采样如下，可通过调用API: ``bk_aud_set_dac_samp_rate(aud_dac_samp_rate_t samp_rate)``来实现。
  
  - 11.025K
  - 12K
  - 22.05K
  - 24K

其他说明：

此外还提供了DAC直接播放PCM数据的demo，将不同采样率的一部分PCM数据存放到数组中，通过DMA或者CPU将数据搬到DAC FIFO中去播放。

+------------------------------------------------------+------------------------+
|Command                                               |Description             |
+======================================================+========================+
|aud_pcm_mcp_test 8000/16000/44100/48000 {start}       |cpu搬运pcm数据至dac     |
+------------------------------------------------------+------------------------+
|aud_pcm_dma_test 8000/16000/44100/48000 {start|stop}  |DMA搬运PCM数据至dac     |
+------------------------------------------------------+------------------------+

.. note::
 - 1.音频文件名需修改为字符型，汉字无效;
 - 2.当前demo设置DAC采样率为48K，使用该demo时需要根据所存放PCM音频的实际采样率进行设置，设置参数位置：``dac_config.samp_rate = AUD_DAC_SAMP_RATE_SOURCE_48K;``
 - 3.cpu搬运pcm数据至dac不支持停止命令，需要停止时只可通过断电方式。
 